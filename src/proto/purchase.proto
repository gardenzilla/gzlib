syntax = "proto3";
package purchase;

service Purchase {
  rpc NewCart(e) returns (CartObject);
  rpc GetCartAll(e) returns (CartIds);
  rpc GetCartById(e) returns (CartObject);
  rpc GetCartInfoBulk(e) returns (stream CartObject);
  rpc CartAddCustomer(e) returns (CartObject);
  rpc CartAddSku(e) returns (e);
  rpc CartRemoveSku(e) returns (e);
  rpc CartAddUpl(e) returns (CartObject);
  rpc CartRemoveUpl(e) returns (CartObject);
  rpc CartSetDocument(e) returns (CartObject);
  rpc CartSetPayment(e) returns (CartObject);
  rpc CartAddPayment(e) returns (CartObject);
  rpc CloseCart(e) returns (PurchaseObject);

  rpc GetPurchaseById(e) returns (PurchaseObject);
  rpc GetPurchaseInfoBulk(e) returns (stream PurchaseInfoObject);
  rpc PurchaseGetAll(e) returns (e);
  rpc PurchaseAddPayment(e) returns (e);
  rpc PurchaseRestore(e) returns (e);
}

message PurchaseObject {}

message PurchaseInfoObject {}

message e {}

message CartIds { repeated string cart_ids = 1; }

message Customer {
  uint32 customer_id = 1;
  string name = 2;
  string address = 3;
  string tax_number = 4;
}

message Payment {
  string payment_id = 1;
  int32 amount = 2;
}

message UplInfoObject {
  message UplKindSku {
    uint32 sku = 1;
    uint32 piece = 2;
  }
  message UplKindDerivedProduct {
    uint32 product_id = 1;
    uint32 amount = 2;
  }
  string upl_id = 1;
  oneof upl_kind {
    UplKindSku sku = 2;
    UplKindDerivedProduct derived_product = 3;
  }
  string name = 4;
  uint32 retail_net_price = 5;
  string vat = 6;
  uint32 retail_gross_price = 7;
  bool depreciated = 8;
}

message CartObject {
  message Item {
    string name = 1;
    uint32 piece = 2;
    uint32 unit_retail_price_net = 3;
    string vat = 4;
    uint32 unit_retail_price_gross = 5;
    uint32 total_retail_price_net = 6;
    uint32 total_retail_price_gross = 7;
  }
  string id = 1;
  Customer customer = 2;
  repeated Item items = 3;
  bool need_invoice = 4;
  string payment_kind = 5; // cash | transfer | card
  repeated Payment payments = 6;
  int32 payment_balance = 7;
  repeated UplInfoObject upls = 8;
  uint32 owner_uid = 9;
  uint32 store_id = 10;
  bool closed = 11;
  uint32 created_by = 15;
  string created_at = 16;
}