syntax = "proto3";
package upl;
import "prelude.proto";

/*
1. Létrehozni
2. Lekérni ID alapján
3. Lekérni helyszín alapján
4. Lekérni Lock alapján
5. Áthelyezni MOVE
6. Szavidő frissítés
7. Szétválasztani SPLIT
8. Kimérni DIVIDE
9. Egyesíteni MERGE
*/

service Upl {
  rpc SetReservation(ReservationRequest) returns (ReservationResponse);
  // // Create new UPL
  // // Just from a procurement or inventory service!
  // // No public API should be implemented!
  // rpc CreateNew(CreateNewRequest) returns (CreateNewResponse);
  // // Get UPL by ID
  // rpc GetById(GetUplRequest) returns (GetUplResponse);
  // // Filters: id, sku, product, location
  // // Returns only the UPL IDs
  // rpc GetBulkByFilter(e) returns (e);
  // // Move a UPL from location A to location B
  // rpc Move(MoveRequest) returns (MoveResponse);
  // // Modify best before date
  // // This should not use at all
  // // As this info should be correctly provided by
  // // the procurement process
  // // The only possible usage to correct a bestbefore date
  // // error during inventory check.
  // rpc SetBestBefore(e) returns (e);
  // rpc Split(e) returns (e);
  // // Lock a UPL that means its cannot be moved
  // // and cannot be modified.
  // // The idea is to use it as a cart lock to
  // // signal that the upl is in a cart
  // // Should be private API
  // rpc Lock(e) returns (e);
  // // Unlock a UPL that means it can be moved
  // // to another location and can be modified.
  // // Should be private API.
  // rpc Unlock(e) returns (e);
}

message e {}

message ReservationRequest {
  message Local {
    string cart_id = 1;
    string stock_id = 2;
    oneof Subject {
      uint32 sku = 3;
      uint32 divided_product = 4;
    }
    uint32 reserved_amount = 5;
  }
  message Global {
    string cart_id = 1;
    oneof Subject {
      uint32 sku = 2;
      uint32 divided_product = 3;
    }
    uint32 reserved_amount = 4;
  }
  oneof reservation {
    Local local = 1;
    Global global = 2;
  }
}

message ReservationResponse {
  message Local {
    string cart_id = 1;
    string stock_id = 2;
    oneof Subject {
      uint32 sku = 3;
      uint32 divided_product = 4;
    }
    uint32 reserved_amount = 5;
    uint32 taken_amount = 6;
  }
  message Global {
    string cart_id = 1;
    oneof Subject {
      uint32 sku = 2;
      uint32 divided_product = 3;
    }
    uint32 reserved_amount = 4;
    uint32 taken_amount = 5;
  }
  oneof reservation {
    Local local = 1;
    Global global = 2;
  }
}

message UplObj {
  enum UplKind {
    Sku = 0;
    BulkSku = 1;
    OpenedSku = 2;
    DerivedProduct = 3;
  }
  enum LockKind {
    CartLock = 0;
    DeliveryLock = 1;
    InventoryLock = 2;
    None = 3;
  }
  enum LocationKind {
    StockLocation = 0;
    CartLocation = 1;
    DeliveryLocation = 2;
    DiscardLocation = 3;
  }
  // UPL ID
  string id = 1;
  // Related product id
  uint32 product_id = 2;
  // Related SKU if there is any, otherwise 0
  uint32 sku = 3;
  // Represents how many UPL this unit contains
  // Can bigger then 1 if UplKind is Bulk
  // Otherwise always 1
  uint32 upl_piece = 4;
  // If UPL is healty: no depreciation, no best_before issue
  bool is_healty = 5;
  // If UplKind is DerivedProduct; this shows its ancestor
  uint32 derived_from = 6;
  // If UplKind is OpenedSku and there are successors (derived products from it)
  repeated uint32 upl_successors = 7;
  // Best before date (NaiveDate YYYY-MM-DD) if there is any
  string best_before = 8;
  // If there is any deprecation data
  bool is_depreciated = 9;
  // Deprecation id; only if depreciated
  uint32 depreciation_id = 10;
  // Deprecation comment; only if depreciated
  string depreciation_comment = 11;
  // Deprecation net price; only if depreciated
  uint32 depreciation_net_price = 12;
  // Procurement id
  uint32 procurement_id = 13;
  // Procurement net price
  uint32 procurement_net_price = 14;
  // Is it divisible? Only if SKU or Derived Product and is divisible
  bool is_divisible = 15;
  // Divisible amount; if divisible; otherwise 0
  uint32 divisible_amount = 16;
  // If there any applied lock
  bool is_locked = 17;
  // If locked; lock kind
  LockKind lock_kind = 18;
  // If locked; lock id
  uint32 lock_id = 19;
  // Location kind
  LocationKind location_kind = 20;
  // Location ID
  uint32 location_id = 21;
  // UPL kind
  UplKind upl_kind = 22;
  // If upl_kind is BULK ? true : false
  bool is_kind_bulk = 23;
  // If upl_kind is OpenedSku ? true : false
  bool is_kind_opened = 24;
  // If upl_kind is Sku ? true : false
  bool is_kind_original = 25;
  // If upl_kind is DerivedProduct ? true : false
  bool is_kind_derived = 26;
  // If upl is archived ? true : false
  bool is_archived = 27;
  // History vector
  repeated string history = 28;
  // Created by user
  string created_by = 29;
  // Created at RFC3339
  string created_at = 30;
}